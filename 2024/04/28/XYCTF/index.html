

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://s2.loli.net/2023/12/20/3Ch7rSnMxbRUkKc.png">
  <link rel="icon" href="https://s2.loli.net/2023/12/20/3Ch7rSnMxbRUkKc.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#79CDCD">
  <meta name="author" content="AlLvia">
  <meta name="keywords" content="">
  
    <meta name="description" content="时长一个月终于结束了，最后只做了一半多一道，还是太菜了，感觉自己如学 x0r解答：nc连接，输入1得iv和enc，输入2后分别将得到的iv和enc输入即可得到flag factor1题目：1234567891011import gmpy2import hashlibfrom Crypto.Util.number import *p &#x3D; getPrime(512)q &#x3D; getPrime(512)d">
<meta property="og:type" content="article">
<meta property="og:title" content="XYCTF-Crypto方向部分wp">
<meta property="og:url" content="http://example.com/2024/04/28/XYCTF/index.html">
<meta property="og:site_name" content="A_Litlle_World">
<meta property="og:description" content="时长一个月终于结束了，最后只做了一半多一道，还是太菜了，感觉自己如学 x0r解答：nc连接，输入1得iv和enc，输入2后分别将得到的iv和enc输入即可得到flag factor1题目：1234567891011import gmpy2import hashlibfrom Crypto.Util.number import *p &#x3D; getPrime(512)q &#x3D; getPrime(512)d">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-04-28T02:19:04.000Z">
<meta property="article:modified_time" content="2024-04-28T02:34:37.900Z">
<meta property="article:author" content="AlLvia">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>XYCTF-Crypto方向部分wp - A_Litlle_World</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Blog-&#39;LD</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="XYCTF-Crypto方向部分wp"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-04-28 10:19" pubdate>
          2024年4月28日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          10 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">XYCTF-Crypto方向部分wp</h1>
            
            
              <div class="markdown-body">
                
                <p>时长一个月终于结束了，最后只做了一半多一道，还是太菜了，感觉自己如学</p>
<h3 id="x0r"><a href="#x0r" class="headerlink" title="x0r"></a>x0r</h3><h4 id="解答："><a href="#解答：" class="headerlink" title="解答："></a>解答：</h4><p>nc连接，输入1得iv和enc，输入2后分别将得到的iv和enc输入即可得到flag</p>
<h3 id="factor1"><a href="#factor1" class="headerlink" title="factor1"></a>factor1</h3><h4 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>d = getPrime(<span class="hljs-number">512</span>)<br>e = gmpy2.invert(d, (p**<span class="hljs-number">3</span> - <span class="hljs-number">1</span>) * (q**<span class="hljs-number">3</span> - <span class="hljs-number">1</span>))<br>flag = <span class="hljs-string">&quot;XYCTF&#123;&quot;</span> + hashlib.md5(<span class="hljs-built_in">str</span>(p + q).encode()).hexdigest() + <span class="hljs-string">&quot;&#125;&quot;</span><br><span class="hljs-built_in">print</span>(e)<br><span class="hljs-built_in">print</span>(p * q)<br></code></pre></td></tr></table></figure>
<h4 id="解答：-1"><a href="#解答：-1" class="headerlink" title="解答："></a>解答：</h4><script type="math/tex; mode=display">\begin{align}
de&\equiv1\pmod{(p^{3}-1)(q^{3}-1)}\\
de&=1+k(p^{3}-1)(q^{3}-1)\\
\frac{e}{(p^{3}-1)(q^{3}-1)}&=\frac{1}{d(p^{3}-1)(q^{3}-1)}+\frac{k}{d}\approx\frac{k}{d}\\
\because(p^{3}-1)(q^{3}-1)&\approx p^{3}q^{3}\\
\therefore \frac{e}{p^{3}q^{3}}&\approx\frac{k}{d}
\end{align}</script><p>因此通过连分数展开的思想得到k、d<br>令$x=p+q$, $temp=\frac{ed-1}{k}$</p>
<script type="math/tex; mode=display">\begin{align}
temp=(p^{3}-1)(q^{3}-1)&=p^{3}q^{3}-p^{3}-q^{3}+1\\
p^{3}+q^{3}&=p^{3}q^{3}-temp-1\\
x^3-3pqx&=p^{3}q^{3}-temp-1\\
f=x^3-3pqx&-(p^{3}q^{3}-temp-1)
\end{align}</script><p>求解多项式即可得到x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># sage:</span><br>e = ...<br>pq = ...<br>pqx = pq ^ <span class="hljs-number">3</span><br>fra = (e/pqx).continued_fraction()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(fra)):<br>    k, d = fra.numerator(i), fra.denominator(i)<br>    <span class="hljs-keyword">if</span> (e*d - <span class="hljs-number">1</span>) % k == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> d &gt; <span class="hljs-number">2</span>^<span class="hljs-number">250</span>:<br>        <span class="hljs-keyword">break</span><br><br>temp = (e*d - <span class="hljs-number">1</span>) // k<br>pq3 = pqx - temp + <span class="hljs-number">1</span><br>x = PolynomialRing(RationalField(), <span class="hljs-string">&#x27;x&#x27;</span>).gen()<br>f = x^<span class="hljs-number">3</span>-<span class="hljs-number">3</span>*pq*x-pq3<br>p_q = <span class="hljs-built_in">int</span>(f.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])<br><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> iroot<br><span class="hljs-keyword">import</span> hashlib<br><br>flag = <span class="hljs-string">&quot;XYCTF&#123;&quot;</span> + hashlib.md5(<span class="hljs-built_in">str</span>(p_q).encode()).hexdigest() + <span class="hljs-string">&quot;&#125;&quot;</span><br><span class="hljs-built_in">print</span>(flag)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">XYCTF&#123;a83211a70e18145a59671c08ddc67ba4&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="factor3"><a href="#factor3" class="headerlink" title="factor3"></a>factor3</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52640415/article/details/130625454">薅过来用</a></p>
<h4 id="题目：-1"><a href="#题目：-1" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br><br>flag = <span class="hljs-string">b&#x27;XYCTF&#123;*****&#125;&#x27;</span><br>m = bytes_to_long(flag)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gainPrime</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        x = random.getrandbits(<span class="hljs-number">256</span>)<br>        y = random.getrandbits(<span class="hljs-number">256</span>)<br><br>        <span class="hljs-keyword">if</span> y % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">continue</span><br><br>        p = x ** <span class="hljs-number">3</span> + <span class="hljs-number">3</span> * y ** <span class="hljs-number">3</span><br>        <span class="hljs-keyword">if</span> p.bit_length() == <span class="hljs-number">768</span> <span class="hljs-keyword">and</span> p % <span class="hljs-number">2</span> == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> isPrime(p):<br>            <span class="hljs-keyword">return</span> p<br><br>p, q = gainPrime(), gainPrime()<br>N = p * q<br>phi = (p ** <span class="hljs-number">2</span> + p + <span class="hljs-number">1</span>) * (q ** <span class="hljs-number">2</span> + q + <span class="hljs-number">1</span>)<br>d = getPrime(<span class="hljs-number">320</span>)<br>e = inverse(d, phi)<br>c = d**<span class="hljs-number">2</span>^m<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;N: <span class="hljs-subst">&#123;N&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c: <span class="hljs-subst">&#123;c&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure>
<h4 id="解答：-2"><a href="#解答：-2" class="headerlink" title="解答："></a>解答：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#sage</span><br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment">############################################</span><br><span class="hljs-comment"># Config</span><br><span class="hljs-comment">##########################################</span><br><br>debug = <span class="hljs-literal">True</span><br>strict = <span class="hljs-literal">False</span><br>helpful_only = <span class="hljs-literal">True</span><br>dimension_min = <span class="hljs-number">7</span> <span class="hljs-comment"># stop removing if lattice reaches that dimension</span><br><br><span class="hljs-comment">############################################</span><br><span class="hljs-comment"># Functions</span><br><span class="hljs-comment">##########################################</span><br><span class="hljs-comment"># display stats on helpful vectors</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">helpful_vectors</span>(<span class="hljs-params">BB, modulus</span>):<br>    nothelpful = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(BB.dimensions()[<span class="hljs-number">0</span>]):<br>        <span class="hljs-keyword">if</span> BB[ii,ii] &gt;= modulus:<br>            nothelpful += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(nothelpful, <span class="hljs-string">&quot;/&quot;</span>, BB.dimensions()[<span class="hljs-number">0</span>], <span class="hljs-string">&quot; vectors are not helpful&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">matrix_overview</span>(<span class="hljs-params">BB, bound</span>):<br>    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(BB.dimensions()[<span class="hljs-number">0</span>]):<br>        a = (<span class="hljs-string">&#x27;%02d &#x27;</span> % ii)<br>        <span class="hljs-keyword">for</span> jj <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(BB.dimensions()[<span class="hljs-number">1</span>]):<br>            a += <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">if</span> BB[ii,jj] == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;X&#x27;</span><br>            <span class="hljs-keyword">if</span> BB.dimensions()[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">60</span>:<br>                a += <span class="hljs-string">&#x27; &#x27;</span><br>        <span class="hljs-keyword">if</span> BB[ii, ii] &gt;= bound:<br>            a += <span class="hljs-string">&#x27;~&#x27;</span><br>        <span class="hljs-built_in">print</span>(a)<br><br>  <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_unhelpful</span>(<span class="hljs-params">BB, monomials, bound, current</span>):<br>    <span class="hljs-keyword">if</span> current == -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> BB.dimensions()[<span class="hljs-number">0</span>] &lt;= dimension_min:<br>        <span class="hljs-keyword">return</span> BB<br><br>    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(current, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> BB[ii, ii] &gt;= bound:<br>            affected_vectors = <span class="hljs-number">0</span><br>            affected_vector_index = <span class="hljs-number">0</span><br><br>            <span class="hljs-comment"># let&#x27;s check if it affects other vectors</span><br>            <span class="hljs-keyword">for</span> jj <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ii + <span class="hljs-number">1</span>, BB.dimensions()[<span class="hljs-number">0</span>]):<br>                <span class="hljs-keyword">if</span> BB[jj, ii] != <span class="hljs-number">0</span>:<br>                    affected_vectors += <span class="hljs-number">1</span><br>                    affected_vector_index = jj<br><br>            <span class="hljs-keyword">if</span> affected_vectors == <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;* removing unhelpful vector&quot;</span>, ii)<br>                BB = BB.delete_columns([ii])<br>                BB = BB.delete_rows([ii])<br>                monomials.pop(ii)<br>                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="hljs-number">1</span>)<br>                <span class="hljs-keyword">return</span> BB<br><br>            <span class="hljs-keyword">elif</span> affected_vectors == <span class="hljs-number">1</span>:<br>                affected_deeper = <span class="hljs-literal">True</span><br><br>                <span class="hljs-keyword">for</span> kk <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(affected_vector_index + <span class="hljs-number">1</span>, BB.dimensions()[<span class="hljs-number">0</span>]):<br>                <br>                    <span class="hljs-keyword">if</span> BB[kk, affected_vector_index] != <span class="hljs-number">0</span>:<br>                        affected_deeper = <span class="hljs-literal">False</span><br>  <br>                <span class="hljs-keyword">if</span> affected_deeper <span class="hljs-keyword">and</span> <span class="hljs-built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="hljs-built_in">abs</span>(bound - BB[ii, ii]):<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="hljs-string">&quot;and&quot;</span>, affected_vector_index)<br>                    BB = BB.delete_columns([affected_vector_index, ii])<br>                    BB = BB.delete_rows([affected_vector_index, ii])<br>                    monomials.pop(affected_vector_index)<br>                    monomials.pop(ii)<br>                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="hljs-number">1</span>)<br>                    <span class="hljs-keyword">return</span> BB<br>    <span class="hljs-keyword">return</span> BB<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>(<span class="hljs-params">N, e, m, t, X, Y</span>):<br>    modulus = e<br>    PR.&lt;x, y&gt; = PolynomialRing(ZZ)<br>    a = N + <span class="hljs-number">1</span><br>    b = N * N - N + <span class="hljs-number">1</span><br>    f = x * (y * y + a * y + b) + <span class="hljs-number">1</span><br>    gg = []<br>    <br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, m+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k, m+<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span> * k, <span class="hljs-number">2</span> * k + <span class="hljs-number">2</span>):<br>                gg.append(x^(i-k) * y^(j-<span class="hljs-number">2</span>*k) * f^k * e^(m - k))<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, m+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k, k+<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>*k+<span class="hljs-number">2</span>, <span class="hljs-number">2</span>*i+t+<span class="hljs-number">1</span>):<br>                gg.append(x^(i-k) * y^(j-<span class="hljs-number">2</span>*k) * f^k * e^(m - k))<br>                <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">order_gg</span>(<span class="hljs-params">idx, gg, monomials</span>):<br>        <span class="hljs-keyword">if</span> idx == <span class="hljs-built_in">len</span>(gg):<br>            <span class="hljs-keyword">return</span> gg, monomials<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(idx, <span class="hljs-built_in">len</span>(gg)):<br>            polynomial = gg[i]<br>            non = []<br>            <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> polynomial.monomials():<br>                <span class="hljs-keyword">if</span> monomial <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> monomials:<br>                    non.append(monomial)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(non) == <span class="hljs-number">1</span>:<br>                new_gg = gg[:]<br>                new_gg[i], new_gg[idx] = new_gg[idx], new_gg[i]<br>                <span class="hljs-keyword">return</span> order_gg(idx + <span class="hljs-number">1</span>, new_gg, monomials + non)    <br>    gg, monomials = order_gg(<span class="hljs-number">0</span>, gg, [])<br>  <br>    nn = <span class="hljs-built_in">len</span>(monomials)<br>    BB = Matrix(ZZ, nn)<br>    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nn):<br>        BB[ii, <span class="hljs-number">0</span>] = gg[ii](<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">for</span> jj <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nn):<br>            <span class="hljs-keyword">if</span> monomials[jj] <span class="hljs-keyword">in</span> gg[ii].monomials():<br>                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](X, Y)<br><br>    <span class="hljs-keyword">if</span> helpful_only:<br>        <span class="hljs-comment"># automatically remove</span><br>        BB = remove_unhelpful(BB, monomials, modulus^m, nn-<span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># reset dimension</span><br>        nn = BB.dimensions()[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> nn == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;failure&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>,<span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">if</span> debug:<br>        helpful_vectors(BB, modulus^m)<br>    <span class="hljs-comment"># check if determinant is correctly bounded</span><br>    det = BB.det()<br>    bound = modulus^(m*nn)<br>    <span class="hljs-keyword">if</span> det &gt;= bound:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Try with highers m and t.&quot;</span>)<br>        <span class="hljs-keyword">if</span> debug:<br>            diff = (log(det) - log(bound)) / log(<span class="hljs-number">2</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))<br>        <span class="hljs-keyword">if</span> strict:<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> debug:<br>        matrix_overview(BB, modulus^m)<br>    <span class="hljs-keyword">if</span> debug:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)<br>    BB = BB.LLL()<br>    <span class="hljs-keyword">if</span> debug:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;LLL is done!&quot;</span>)<br>    <span class="hljs-keyword">if</span> debug:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;looking for independent vectors in the lattice&quot;</span>)<br>        <br>    found_polynomials = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> pol1_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nn - <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> pol2_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(pol1_idx + <span class="hljs-number">1</span>, nn):<br>            PR.&lt;a, b&gt; = PolynomialRing(ZZ)<br>            pol1 = pol2 = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">for</span> jj <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nn):<br>                pol1 += monomials[jj](a,b) * BB[pol1_idx, jj] / monomials[jj](X, Y)<br>                pol2 += monomials[jj](a,b) * BB[pol2_idx, jj] / monomials[jj](X, Y)<br>            PR.&lt;q&gt; = PolynomialRing(ZZ)<br>            rr = pol1.resultant(pol2)<br>  <br>            <span class="hljs-keyword">if</span> rr.is_zero() <span class="hljs-keyword">or</span> rr.monomials() == [<span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="hljs-string">&quot;and&quot;</span>, pol2_idx)<br>                found_polynomials = <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> found_polynomials:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found_polynomials:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    rr = rr(q, q)<br>    <span class="hljs-comment"># solutions</span><br>    soly = rr.roots()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(soly) == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Your prediction (delta) is too small&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    soly = soly[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    ss = pol1(q, soly)<br>    solx = ss.roots()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> solx, soly<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inthroot</span>(<span class="hljs-params">a, n</span>):<br>    <span class="hljs-keyword">return</span> a.nth_root(n, truncate_mode=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]<br>N = <span class="hljs-number">913125842482770239379848062277162627509794409924607555622246822717218133091223291889541294440266178282194506242444509803611492259403578922020590849630191477864719052980160940803309686069818208833547621252544423652489179493083138385424424384165228024273745733240109761707533778691158938848158094054261174692601673435971526522219273943464877956131040249169850420336023942653021547841666224446678539579529590840999008107782784268926145671962239929431694391039559247</span><br><br>e = <span class="hljs-number">494518390582436635999115147756676313570637682518235195828939117782099618734167908630788943568232122157772909140885391963441876427590731524706959546524212914108888799081844320513851526790475333924396837458796755678072486028072639014677580265244176441153444956871730684233063789931539669072735599696830757690822185323538738397827461580678488181113667710378657058297572328491762536595872579603698945272140918157163640403488075948987156585480146162739943419183496337465468187233821931312507662218106713861638334075899266373256620752680354704533272722692596941861606161634082613228896420520465402725359166156632884432690715903666803067996854084671477445131853993177110154928274312496230096270510089973592664248613332000290545537840595645944390047611474888693558676781309912289044962293014118087259307560444929227407113819165713213046898243995956550944640168932947118400215917515277554126694376415569909534496134700668701465649939</span><br><br>X = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">469</span><br><br>Y = <span class="hljs-number">2</span> * inthroot(Integer(<span class="hljs-number">2</span> * N), <span class="hljs-number">2</span>)<br><br>res = attack(N, e, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, X, Y)<br><br><span class="hljs-built_in">print</span>(res)<br><br>b, c = res[<span class="hljs-number">1</span>], N<br><br>Dsqrt =  inthroot(Integer(b^<span class="hljs-number">2</span>-<span class="hljs-number">4</span>*c),<span class="hljs-number">2</span>)<br><br>p, q = (b + Dsqrt) // <span class="hljs-number">2</span>, (b - Dsqrt) // <span class="hljs-number">2</span><br><br><span class="hljs-keyword">assert</span> p * q == N<br><span class="hljs-built_in">print</span>(p)<br><span class="hljs-built_in">print</span>(q)<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>p = <span class="hljs-number">1079692686288325812308630934214667048073665141240195252583556389192093937087035206847129125872559936616225942097278411602071282941911673739879515157769270737229378250560113256396308250699296075273110248314981762673299506406938725953</span><br>q = <span class="hljs-number">845727542734252771097508620366884787581346823455578404917525769041539439746914530374958818236462967773717478357930648479282951655380705183747821800053493097745787392338644671787997907165214166274630065657567039034950440073852768399</span><br>c = <span class="hljs-number">4450931337369461482106945992542133557585962894030505065110870389112565329875502952762182372926117037373210509516570958483606566274369840551132381128665744266165792377925899683228751870742727716</span><br>N = p * q<br>phi = (p ** <span class="hljs-number">2</span> + p + <span class="hljs-number">1</span>) * (q ** <span class="hljs-number">2</span> + q + <span class="hljs-number">1</span>)<br>e = <span class="hljs-number">494518390582436635999115147756676313570637682518235195828939117782099618734167908630788943568232122157772909140885391963441876427590731524706959546524212914108888799081844320513851526790475333924396837458796755678072486028072639014677580265244176441153444956871730684233063789931539669072735599696830757690822185323538738397827461580678488181113667710378657058297572328491762536595872579603698945272140918157163640403488075948987156585480146162739943419183496337465468187233821931312507662218106713861638334075899266373256620752680354704533272722692596941861606161634082613228896420520465402725359166156632884432690715903666803067996854084671477445131853993177110154928274312496230096270510089973592664248613332000290545537840595645944390047611474888693558676781309912289044962293014118087259307560444929227407113819165713213046898243995956550944640168932947118400215917515277554126694376415569909534496134700668701465649939</span><br><br>d = gmpy2.invert(e, phi)<br>m = d**<span class="hljs-number">2</span>^c<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;XYCTF&#123;I_love_to_read_the_crypto_paper_and_try_to_ak_them&#125;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>板子的论文：<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2021/1160.pdf">1160.pdf (iacr.org)</a></p>
<h3 id="happy-to-solve1"><a href="#happy-to-solve1" class="headerlink" title="happy_to_solve1"></a>happy_to_solve1</h3><h4 id="题目：-2"><a href="#题目：-2" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> sympy<br><span class="hljs-keyword">from</span> secrets <span class="hljs-keyword">import</span> flag<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_happy_prime</span>():<br>    p = getPrime(<span class="hljs-number">512</span>)<br>    q = sympy.nextprime(p ^ ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">512</span>) - <span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">return</span> p, q<br><br><br>m = bytes_to_long(flag)<br>p, q = get_happy_prime()<br>n = p * q<br>e = <span class="hljs-number">65537</span><br><span class="hljs-built_in">print</span>(n)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(m, e, n))<br></code></pre></td></tr></table></figure>
<h4 id="解答：-3"><a href="#解答：-3" class="headerlink" title="解答："></a>解答：</h4><p>由异或性质得：如果a&gt;b，且a为二进制全为1,那么a^b=a-b<br>所以((1&lt;<512)-1)^p=(1<<1024)-p。
设p^((1<<512)-1)的下一个素数与p^((1<<512)-1)相差r，
则$q=(1<<512-1)-p+r$，
$p+q=1<<512-1+r$，
$p+q\approx 1<<512$，
$n=pq=(\frac{p+q}{2})^{2}-(\frac{p-q}{2})^{2}$，
将$p+q$带入得$p-q\approx\sqrt{(p+q)^{2}-4n}$，
所以$p\approx\frac{(1<<1024)+\sqrt{(1<<1024)^{2}}-4n}{2}$，
根据n%p=0向后爆破
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">n = <span class="hljs-number">24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span><br>c = <span class="hljs-number">14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span><br><br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>e=<span class="hljs-number">65537</span><br>t1=<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">1024</span><br>p=(<span class="hljs-number">2</span>**<span class="hljs-number">512</span>+gmpy2.iroot((<span class="hljs-number">2</span>**<span class="hljs-number">1024</span>-<span class="hljs-number">4</span>*n,<span class="hljs-number">2</span>)[<span class="hljs-number">0</span>])//<span class="hljs-number">2</span><br>p=<span class="hljs-built_in">int</span>(p)<br><span class="hljs-keyword">while</span> n%p!=<span class="hljs-number">0</span>:<br>    p=gmpy2.next_prime(p)<br>q=n//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=gmpy2.invert(e,phi)<br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;XYCTF&#123;3f22f4efe3bbbc71bbcc999a0a622a1a23303cdc&#125;&#x27;</span><br></code></pre></td></tr></table></figure></p>
<h3 id="happy-to-solve2"><a href="#happy-to-solve2" class="headerlink" title="happy_to_solve2"></a>happy_to_solve2</h3><h4 id="题目：-3"><a href="#题目：-3" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secrets <span class="hljs-keyword">import</span> flag<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_happy_prime</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        p = <span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;&quot;</span>.join([random.choice(<span class="hljs-string">&quot;123&quot;</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">512</span>)]))<br>        q = <span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;&quot;</span>.join([random.choice(<span class="hljs-string">&quot;567&quot;</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">512</span>)]))<br>        <span class="hljs-keyword">if</span> isPrime(p) <span class="hljs-keyword">and</span> isPrime(q):<br>            <span class="hljs-keyword">return</span> (p,q)<br><br>m = bytes_to_long(flag)<br>p ,q= get_happy_prime()<br>n = p * q<br>e = <span class="hljs-number">65537</span><br><span class="hljs-built_in">print</span>(n)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(m, e, n))<br></code></pre></td></tr></table></figure>
<h4 id="解答：-4"><a href="#解答：-4" class="headerlink" title="解答："></a>解答：</h4><p>用$pq\equiv 10\mod{10^{i}}$  DFS 搜寻<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>n = <span class="hljs-number">697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span><br>c = <span class="hljs-number">153383826085102296581238539677668696644156148059026868813759015106139131297135097831661048493079405226972222492151356105759235749502324303047037349410709021152255315429280760639113724345836532087970918453353723090554450581657930847674930226113840172368662838756446364482977092478979838209396761279326533419699056209983721842484996150025403009644653678928025861445324715419893797015875541525590135843027312322236085581571452084477262582966972702577136904385741443870527205640874446616413917231260133364227248928492574610248881137364204914001412269740461851747883355414968499272944590071623223603501698004227753335552646715567802825755799597955409228004284739743749531270833084850113574712041224896044525292591264637452797151098802604186311724597450780520140413704697374209653369969451501627583467893160412780732575085846467289134920886789952338174193202234175299652687560232593212131693456966318670843605238958724126368185289703563591477049105538528244632434869965333722691837462591128379816582723367039674028619947057144546</span><br>e = <span class="hljs-number">65537</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">base10</span>(<span class="hljs-params">ss</span>):<br>    r = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ss[::-<span class="hljs-number">1</span>]:<br>        r = r * <span class="hljs-number">10</span> + x<br>    <span class="hljs-keyword">return</span> r<br>  <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">ps, qs, mod</span>):<br>    <span class="hljs-keyword">if</span> base10(ps) * base10(qs) == n:<br>        <span class="hljs-keyword">yield</span> base10(ps), base10(qs)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">for</span> pp, qq <span class="hljs-keyword">in</span> product((<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>)):<br>        p = base10(ps + [pp])<br>        q = base10(qs + [qq])<br>        <span class="hljs-keyword">if</span> p * q % mod == n % mod:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> dfs(ps + [pp], qs + [qq], mod * <span class="hljs-number">10</span>)<br>  <br><br>p, q = <span class="hljs-built_in">next</span>(dfs([], [], <span class="hljs-number">1</span>))<br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi)<br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">XYCTF&#123;7f4b2241951976ce5ef6df44503209059997e5085d1bc21f6bef4d9effb29fd0&#125;</span><br></code></pre></td></tr></table></figure><br>参考：<a target="_blank" rel="noopener" href="https://blog.maple3142.net/2024/03/03/osu-gaming-ctf-2024-writeups/#no-dorchadas">https://blog.maple3142.net/2024/03/03/osu-gaming-ctf-2024-writeups/#no-dorchadas</a></p>
<h3 id="Sign1n-签到-amp-Sign1n-Revenge"><a href="#Sign1n-签到-amp-Sign1n-Revenge" class="headerlink" title="Sign1n[签到] &amp; Sign1n_Revenge"></a>Sign1n[签到] &amp; Sign1n_Revenge</h3><p>两个签到的b不一样，莫非是传说中的动态附件？<br>题解就b不一样，这里就放一个的了</p>
<h4 id="题目：-4"><a href="#题目：-4" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br>flag=<span class="hljs-string">b&#x27;XYCTF&#123;uuid&#125;&#x27;</span><br>flag=bytes_to_long(flag)<br>leak=<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">int</span>(flag))<br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    leak += <span class="hljs-string">&quot;0&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(leak) == <span class="hljs-number">514</span>:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">swap_bits</span>(<span class="hljs-params">input_str</span>):<br>    input_list = <span class="hljs-built_in">list</span>(input_str[<span class="hljs-number">2</span>:])<br>    length = <span class="hljs-built_in">len</span>(input_list)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length // <span class="hljs-number">2</span>):<br>        temp = input_list[i]<br>        input_list[i] = input_list[length - <span class="hljs-number">1</span> - i]<br>        input_list[length - <span class="hljs-number">1</span> - i] = temp<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(input_list)<br><br>input_str = leak<br>result = swap_bits(input_str)<br>a=result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_add</span>(<span class="hljs-params">input_str</span>):<br>    input_list = <span class="hljs-built_in">list</span>(input_str)<br>    length = <span class="hljs-built_in">len</span>(input_list)<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>        input_list[i] = <span class="hljs-built_in">str</span>((<span class="hljs-built_in">int</span>(input_list[i]) + i + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span>)<br><br>    result = <span class="hljs-string">&#x27;&#x27;</span>.join(input_list)<br>    <span class="hljs-keyword">return</span> result<br><br><br>input_str = a<br>result = custom_add(input_str)<br>b=result<br><span class="hljs-built_in">print</span>(b)<br></code></pre></td></tr></table></figure>
<h4 id="解答：-5"><a href="#解答：-5" class="headerlink" title="解答："></a>解答：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python">b = <span class="hljs-number">12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567789113445678012235677900133457889012456679901245577801223567790012355788911245667890134456789122355788001245578891223566790113445778902335578800123457889122346778011344567991223557880012346788912335667991134457789122355788001244578891223467799012455688912234667900133557889022356678901344578801233467789112355779912234577990233556780113</span><br>b = <span class="hljs-built_in">str</span>(b)<br><span class="hljs-built_in">print</span>(b)<br>  <br><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_add</span>(<span class="hljs-params">input_str</span>):<br>    input_list = <span class="hljs-built_in">list</span>(input_str)<br>    length = <span class="hljs-built_in">len</span>(input_list)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>        input_list[i] = <span class="hljs-built_in">str</span>((<span class="hljs-built_in">int</span>(input_list[i]) - i - <span class="hljs-number">1</span>) % <span class="hljs-number">10</span>)<br>    result = <span class="hljs-string">&#x27;&#x27;</span>.join(input_list)<br>    <span class="hljs-keyword">return</span> result[[扩展维纳攻击]]<br><br>a = custom_add(b)<br><span class="hljs-built_in">print</span>(a)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">swap_bits</span>(<span class="hljs-params">input_str</span>):<br>    input_list = <span class="hljs-built_in">list</span>(input_str[<span class="hljs-number">2</span>:])<br>    length = <span class="hljs-built_in">len</span>(input_list)<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length // <span class="hljs-number">2</span>):<br>        temp = input_list[i]<br>        input_list[i] = input_list[length - <span class="hljs-number">1</span> - i]<br>        input_list[length - <span class="hljs-number">1</span> - i] = temp<br>        <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(input_list)<br>f = swap_bits(a)<br><span class="hljs-built_in">print</span>(f)<br><span class="hljs-comment"># 去掉末尾的0</span><br>binary = <span class="hljs-number">0b1011000010110010100001101010100010001100111101100110000001100100011010100110010001100100110000101100011001100100010110100110001001101010011011100111000001011010011010000110110011000110011000000101101011000010011011100110011001101100010110100110000001100000011100100110100001101110011100101100001001110000011000100110111001110000011010001111101</span><br><span class="hljs-built_in">print</span>(long_to_bytes(binary))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;XYCTF&#123;02522ac2-1578-46c0-a736-009479a81784&#125;&#x27;</span><br></code></pre></td></tr></table></figure>
<h3 id="BabyRSAMAX"><a href="#BabyRSAMAX" class="headerlink" title="BabyRSAMAX"></a>BabyRSAMAX</h3><h4 id="题目：-5"><a href="#题目：-5" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> choice<br><br>flag = <span class="hljs-string">b&#x27;XYCTF&#123;******&#125;&#x27;</span><br>e = <span class="hljs-string">&#x27;?&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getBabyPrime</span>(<span class="hljs-params">nbits</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        p = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> p.bit_length() &lt;= nbits:<br>            p *= choice(sieve_base)<br>        <br>        <span class="hljs-keyword">if</span> isPrime(p+<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">return</span> p+<span class="hljs-number">1</span><br><br>p = getBabyPrime(<span class="hljs-number">512</span>)<br>q = getBabyPrime(<span class="hljs-number">512</span>)<br>n = p*q<br>gift1 = (<span class="hljs-built_in">pow</span>(p,e,n)-<span class="hljs-built_in">pow</span>(q,e,n)) % n<br>gift2 = <span class="hljs-built_in">pow</span>(p+q,e,n)<br><br>t = <span class="hljs-number">65537</span><br>x = bytes_to_long(e)<br>y = <span class="hljs-built_in">pow</span>(x, t, n)<br><br>m = bytes_to_long(flag)<br>c = powmod(m, e, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;n = <span class="hljs-subst">&#123;n&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;gift1 = <span class="hljs-subst">&#123;gift1&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;gift2 = <span class="hljs-subst">&#123;gift2&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c = <span class="hljs-subst">&#123;c&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;y = <span class="hljs-subst">&#123;y&#125;</span>&#x27;</span>)<br><br></code></pre></td></tr></table></figure>
<h4 id="解答：-6"><a href="#解答：-6" class="headerlink" title="解答："></a>解答：</h4><p>$g1=p^{e}-q^{e}\mod{n}$<br>$g2=(p+q)^{e}\mod{n}=p^{e}+q^{e}\mod{n}$<br>$g1+g2=2p^{e}\mod{n}$<br>$g2-g1=2q^{e}\mod{n}$<br>$\therefore p = gcd(g1+g2,n)$<br>$\therefore q = gcd(g2-g1,n)$</p>
<p>一路算下去发现e与phi不互素，于是模n下对c开4次方<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> choice<br><br>n = <span class="hljs-number">39332423872740210783246069030855946244104982381157166843977599780233911183158560901377359925435092326653303964261550158658551518626014048783435245471536959844874036516931542444719549997971482644905523459407775392702211086149279473784796202020281909706723380472571862792003687423791576530085747716706475220532321</span><br>g1 = <span class="hljs-number">4549402444746338327349007235818187793950285105091726167573552412678416759694660166956782755631447271662108564084382098562999950228708300902201571583419116299932264478381197034402338481872937576172197202519770782458343606060544694608852844228400457232100904217062914047342663534138668490328400022651816597367310</span><br>g2 = <span class="hljs-number">111061215998959709920736448050860427855012026815376672067601244053580566359594802604251992986382187891022583247997994146019970445247509119719411310760491983876636264003942870756402328634092146799825005835867245563420135253048223898334460067523975023732153230791136870324302259127159852763634051238811969161011462</span><br>c = <span class="hljs-number">16938927825234407267026017561045490265698491840814929432152839745035946118743714566623315033802681009017695526374397370343984360997903165842591414203197184946588470355728984912522040744691974819630118163976259246941579063687857994193309554129816268931672391946592680578681270693589911021465752454315629283033043</span><br>y = <span class="hljs-number">1813650001270967709841306491297716908969425248888510985109381881270362755031385564927869313112540534780853966341044526856705589020295048473305762088786992446350060024881117741041260391405962817182674421715239197211274668450947666394594121764333794138308442124114744892164155894256326961605137479286082964520217</span><br>  <br><br>pe = ((g1+g2)//<span class="hljs-number">2</span>)%n<br>qe = ((g2-g1)//<span class="hljs-number">2</span>)%n<br>p = gmpy2.gcd(pe,n)<br>q = gmpy2.gcd(qe,n)<br><span class="hljs-built_in">print</span>(p,q)<br><span class="hljs-built_in">print</span>(p*q==n)<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>t = <span class="hljs-number">65537</span><br>x = <span class="hljs-built_in">pow</span>(y,gmpy2.invert(t,phi),n)<br>e = x<br><br><span class="hljs-built_in">print</span>(long_to_bytes(e))<br>e = <span class="hljs-number">4096</span><br>phi = phi//<span class="hljs-number">4</span><br><br><span class="hljs-comment">#sage</span><br><span class="hljs-comment">#以下是实现开二次方的函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multiplication</span>(<span class="hljs-params">x1,y1,x2,y2,w,p</span>):  <br>    x=(x1*x2+y1*y2*w)%p  <br>    y=(x1*y2+x2*y1)%p  <br>    <span class="hljs-keyword">return</span> x,y  <br>  <br><span class="hljs-comment"># 获取w,使得w = -1 mod p, w是复数元的平方  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_w</span>(<span class="hljs-params">c,p</span>):  <br>    a=randint(<span class="hljs-number">1</span>,p)  <br>    w=<span class="hljs-built_in">pow</span>(a, <span class="hljs-number">2</span>) - c  <br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">pow</span>(w,(p - <span class="hljs-number">1</span>)//<span class="hljs-number">2</span>,p)!=p-<span class="hljs-number">1</span>:  <br>        a=randint(<span class="hljs-number">1</span>,p)  <br>        w=<span class="hljs-built_in">pow</span>(a,<span class="hljs-number">2</span>)-c  <br>    <span class="hljs-keyword">return</span> w,a  <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Cipolla_algorithm</span>(<span class="hljs-params">c,p</span>):  <br>    <span class="hljs-comment">#主体部分  </span><br>    w,a=get_w(c,p)  <br>    power=(p+<span class="hljs-number">1</span>)//<span class="hljs-number">2</span>  <br>    x1=a  <br>    y1=<span class="hljs-number">1</span>  <br>    x=<span class="hljs-number">1</span>  <br>    y=<span class="hljs-number">0</span>  <br>    <span class="hljs-keyword">while</span>(power!=<span class="hljs-number">0</span>):  <br>        <span class="hljs-keyword">if</span>(power!=(p+<span class="hljs-number">1</span>)//<span class="hljs-number">2</span>):  <br>            x1,y1=multiplication(x1,y1,x1,y1,w,p)  <br>        <span class="hljs-keyword">if</span>(power &amp; <span class="hljs-number">1</span>):  <br>            x,y=multiplication(x,y,x1,y1,w,p)  <br>        power&gt;&gt;=<span class="hljs-number">1</span>  <br>    <span class="hljs-keyword">return</span> x<br><span class="hljs-comment">#以下sage直接对cn开两次二次方，因为只有四个解所以偷懒了</span><br>cn = <span class="hljs-built_in">pow</span>(c,<span class="hljs-number">4</span>*<span class="hljs-number">15340221468921505548397362128123138214101003260229144051087454992413006131615185800769124140840468748</span><br><span class="hljs-number">23035337005158475621433705623268639417140515158078335142054666787229183797173181186377993649280</span>,n)<br>cp = cn%p<br>Cipolla_algorithm(cn,p)%p<br><span class="hljs-number">166353789373057352195268573847472134983952212264580315606750168640904529917560511398152614100259694276272602506054433757749654828608600573448732931745676174</span><br><br>sage: Cipolla_algorithm(cn,p)%p<br><span class="hljs-number">1320925615378691609936673193334302667304516095065655944868325562479391795804424371343552922650946388889883899419614130483678902025</span><br>sage: Cipolla_algorithm(cn,p)%p<br><span class="hljs-number">166353789373057352195268573847472134983952212264580315606750168640904529917560511398152614100259694276272602506054433757749654828608600573448732931745676174</span><br>sage: Cipolla_algorithm(<span class="hljs-number">166353789373057352195268573847472134983952212264580315606750168640904529917560511398152614100259694276272602506054433757749654828608600573448732931745676174</span>,p)%p<br><span class="hljs-number">0</span><br>sage: Cipolla_algorithm(<span class="hljs-number">1320925615378691609936673193334302667304516095065655944868325562479391795804424371343552922650946388889883899419614130483678902025</span>,p)%p<br><span class="hljs-number">36344540379246669047243921781711114415694316462518391812884210045</span><br>sage: Cipolla_algorithm(<span class="hljs-number">1320925615378691609936673193334302667304516095065655944868325562479391795804424371343552922650946388889883899419614130483678902025</span>,p)%p<br><span class="hljs-number">166353789373057352195268575168397750362643822201253508941052835945420624983216456266478176543306949701450304802363434626984929302798183530544471602540368154</span><br></code></pre></td></tr></table></figure><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#长度较短的通常会是flag，直接尝试最短的，得到flag</span><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-number">36344540379246669047243921781711114415694316462518391812884210045</span>))<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;XYCTF&#123;Rabin_is_so_biggggg!&#125;&#x27;</span><br></code></pre></td></tr></table></figure><br>实现开二次方的函数来源：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lovechan/articles/17517915.html">https://www.cnblogs.com/Lovechan/articles/17517915.html</a></p>
<h3 id="fakeRSA"><a href="#fakeRSA" class="headerlink" title="fakeRSA"></a>fakeRSA</h3><h4 id="题目：-6"><a href="#题目：-6" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>flag = <span class="hljs-string">b&#x27;XYCTF&#123;******&#125;&#x27;</span><br>n = ZZ(bytes_to_long(flag))<br>p = getPrime(<span class="hljs-built_in">int</span>(<span class="hljs-number">320</span>))<br><span class="hljs-built_in">print</span>(p)<br><br>G = Zmod(p)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">function</span>(<span class="hljs-params">X, Y, Z</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">part</span>(<span class="hljs-params">a, b, c</span>):<br>        <span class="hljs-keyword">return</span> vector([<span class="hljs-number">9</span> * a - <span class="hljs-number">36</span> * c, <span class="hljs-number">6</span> * a - <span class="hljs-number">27</span> * c, b])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parts</span>(<span class="hljs-params">n</span>):<br>        Gx.&lt;a, b, c&gt; = G[]<br>        <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> vector([a, b, c])<br>        mid = parts(n // <span class="hljs-number">2</span>)<br>        result = mid(*mid)<br>        <span class="hljs-keyword">if</span> n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">else</span>: <span class="hljs-keyword">return</span> part(*result)<br>    <span class="hljs-keyword">return</span> parts(n)(X, Y, Z)<br><br><span class="hljs-built_in">print</span>(function(<span class="hljs-number">69</span>, <span class="hljs-number">48</span>, <span class="hljs-number">52</span>))<br></code></pre></td></tr></table></figure>
<h4 id="解答：-7"><a href="#解答：-7" class="headerlink" title="解答："></a>解答：</h4><p>hint中提到jordan标准型，现学又加一</p>
<script type="math/tex; mode=display">f(i, a, p) = \left( \sum_{j=0}^{len(a)-1} i^j \cdot a[j] \right) \mod p</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#sage</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>p = <span class="hljs-number">1849790472911267366045392456893126092698743308291512220657006129900961168811898822553602045875909</span><br>K = Zmod(p)<br>A = matrix(K, [[<span class="hljs-number">9</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">36</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">27</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]])<br>u = vector(K, (<span class="hljs-number">69</span>, <span class="hljs-number">48</span>, <span class="hljs-number">52</span>))<br>v = vector(<br>    K,<br>    (<br>        <span class="hljs-number">1431995965813617415860695748430644570118959991271395110995534704629241309597572003500157255135707</span>,<br>        <span class="hljs-number">1011565891130611736600822618382801465506651972373410962205810570075870804325974377971089090196019</span>,<br>        <span class="hljs-number">784497518859893244278116222363814433595961164446277297084989532659832474887622082585456138030246</span>,<br>    ),<br>)<br>J, P = A.jordan_form(transformation=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># A^n*v=u</span><br><span class="hljs-comment"># A=PJP^-1</span><br><span class="hljs-comment"># J^n*vv=uu</span><br><span class="hljs-built_in">print</span>(J)<br>vv = ~P * v<br>uu = ~P * u<br>a, b, c = uu<br>aa, bb, cc = vv<br>n = (<span class="hljs-number">18</span> * bb * c - <span class="hljs-number">18</span> * b * cc) / (<span class="hljs-number">6</span> * c * cc)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(n)))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[3 1 0]</span><br><span class="hljs-string">[0 3 1]</span><br><span class="hljs-string">[0 0 3]</span><br><span class="hljs-string">b&#x27;XYCTF&#123;y0u_finally_f0und_t3h_s3cr3ts!!&#125;&#x27;</span><br></code></pre></td></tr></table></figure>
<h3 id="random-rr"><a href="#random-rr" class="headerlink" title="random_rr"></a>random_rr</h3><h4 id="题目：-7"><a href="#题目：-7" class="headerlink" title="题目："></a>题目：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br>flag=<span class="hljs-string">b&#x27;XYCTF&#123;uuid&#125;&#x27;</span><br>flag = bytes_to_long(flag)<br>n = <span class="hljs-number">472993274721871037103726599805149366727531552333249750035977291933239067588481589544777397613192273114354221827196579379954069925604091911249655707080927769808587176515295614018992848517984372306879552247519117116110554431341268358177159108949791969262793325836353834899335531293329721598226413212541536002401507477776699642647348576111445702197483449777741566350285229621935507081895389023444249054515395783080003733803406382744631528246608154546123270319561514117323480441428953306734274538511770278887429407127143049023747710881993279361892937905382946820141513009017756811296722630617325141162244806884220212939955235410280899112731530527048274396186038160728562551536558223235783656985493518204710943916486379681906506757757594165379493317173050550893487151879681122510523721157284728808336110950008840684602353984682117748018347433177541603140491131603068512706893984834735290809952944273565203183330739252949245209529232254867201402656024997949207918675051941911990640248052951780195402390132237903538546705181463959793972284823588987652138458328270662652334799233015314673544813649692428544375538627858921763941533600553536579901589575693816746953261108022490849251974419402753031545629158199093099096735356165044275617408697</span><br>rr = <span class="hljs-number">11898141078345200236264081467585899457224809417108457314508072413792599039332439547789237898270544336909458761754683941320649771736625000667170176071314483</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>():<br>    fw = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;random&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">648</span>):<br>        fw.write(<span class="hljs-built_in">str</span>(random.getrandbits(<span class="hljs-number">32</span>))+<span class="hljs-string">&quot;\n&quot;</span>)<br>    fw.close()<br>generate()<br>key = <span class="hljs-built_in">str</span>(random.getrandbits(<span class="hljs-number">32</span>))<br>key1= <span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(key)[<span class="hljs-number">0</span>])<br>ks = [randint(<span class="hljs-number">0</span>, rr**(i+key1-<span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)]<br>c1 = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">sum</span>(k*flag**i <span class="hljs-keyword">for</span> i, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ks)), <span class="hljs-number">127</span>, n)<br>c2 = <span class="hljs-built_in">pow</span>(flag, <span class="hljs-number">65537</span>, n)<br>ks = [<span class="hljs-built_in">pow</span>(<span class="hljs-number">69</span>, k+key, rr**(i+key1)) <span class="hljs-keyword">for</span> i, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ks)]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ks = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c1 = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c2 = &#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>
<h4 id="解答：-8"><a href="#解答：-8" class="headerlink" title="解答："></a>解答：</h4><p>现学<br>翻译开始：<a target="_blank" rel="noopener" href="https://math.stackexchange.com/questions/1863037/discrete-logarithm-modulo-powers-of-a-small-prime">elementary number theory - Discrete logarithm modulo powers of a small prime - Mathematics Stack Exchange</a><br>首先，对于给定的小素数 ( p )，解决形如$ax \equiv b \pmod{p}$的同余方程相对容易，这里假设 ( a ) 和 ( b ) 都不是 ( p ) 的倍数。例如，对于任何偶数指数 ( x )，都有$2x \equiv 28 \pmod{3}$成立。</p>
<p>其次，如果对于某个整数幂$s \geq 1$，存在解$a^{x} \equiv b \pmod{p^s}$，那么解也存在于$p^{s-1}$ 中，一直回溯到 ( p )，也就是<br>$a^{x} \equiv b \pmod{p^s}⟹a^{x} \equiv b \pmod{p^{s-1}}⟹…⟹a^{x} \equiv b \pmod{p}$</p>
<p>Eric Bach（1984年）提出了一个类似于多项式的 Hensel 提升算法的算法，用于在上述同余方程链中向后推进。他的目的是比较对于一般模数$n$求解离散对数问题和因数分解问题的难度，所以这里我们只关注他的工作的一部分。</p>
<p>在此算法中，我们使用模运算下的整数环$\mathbb{Z}$，并且$\mathbb{Z}_n$表示模$n$的整数环。$\mathbb{Z}^*_n$表示其单位元的乘法群，而$\mathbb{Z}^+_n$表示其加法群。需要注意的是，加法群是循环的，有$n$个元素，而乘法群的元素个数由欧拉函数$\phi(n)$给出（计算与$n$互素的介于 0 和$n-1$的整数个数）。</p>
<p>接下来，考虑$n = p^s$是素数的幂次方，其中$s \geq 1$。其单位元群的元素个数可以通过以下方式计算：<script type="math/tex">\phi(p^s) = (p-1)p^{s-1}</script>对于奇素数$p$的情况，乘法群是循环的，其阶数为$(p-1)p^{s-1}$，并且存在一个模$n$的原根。</p>
<p>现在，Bach 从奇素数$p$的情况开始讨论，因此我们知道存在一个同构映射：</p>
<script type="math/tex; mode=display">\mathbb{Z}^*_{p^s} \cong \mathbb{Z}^*_p \times \mathbb{Z}^+_{p^{s-1}}</script><p>易见，对于给定的 $k \in \mathbb{Z}^<em>_{p^s}$，要找到其在第一个因子上的投影，只需将 $k$ 对 $p$ 取模即可。 剩余算法的核心在于展示一个多项式时间可计算的同态投影 $\theta$，将乘法群 $\mathbb{Z}^</em>_{p^s}$ 同态映射到加法群 $\mathbb{Z}^+_{p^{s-1}}$： <script type="math/tex">\theta: \mathbb{Z}^*_{p^s} \rightarrow \mathbb{Z}^+_{p^{s-1}}</script> 一旦我们得到了这个函数，将模 $p$ 下的解 $a^{x_{1}} \equiv b \mod p$ 提升到 $\mathbb{Z}^*_{p^s}$ 中的解 $a^{x_{s}} \equiv b \mod p^s$ 就变得相当自然。需要注意的是，$x_s \equiv x_1 \mod (p-1)$。 将投影 $\theta$ 应用到上述“高阶”同余式中，将会导向到加法群 $\mathbb{Z}^+_{p^{s-1}}$ 中的以下问题： <script type="math/tex">c \cdot \theta(a) \equiv \theta(b) \mod p^{s-1}</script> 这个问题可以通过扩展欧几里得算法，在 $\mathbb{Z}_{p^{s-1}}$ 中求解 $\theta(a)$ 的倒数来解决。 如果我们通过中国剩余定理找到一个整数 $x_s$，满足以下两个条件： <script type="math/tex">x_s \equiv x_1 \mod (p-1)</script> <script type="math/tex">x_s \equiv c \mod p^{s-1}</script> 那么我们就完成了，因为根据同构关系： <script type="math/tex">a^{x_{s}} \equiv b \mod p^s</script></p>
<p>最后，Bach 给出了投影函数$\theta$的公式：</p>
<p>$\theta(k) = \left[ \frac{k^{(p-1)p^{s-1} - 1}}{p^s} \right] \pmod{p^{s-1}}$</p>
<p>这个函数的复杂度在于$p$和$s$的对数阶，如果分子（方括号中整数表达式的分子）在模$p^{2s-1}$下计算，则此函数是多项式时间的。我们需要这么多的基数$p$位数，以便在除以$p^s$后得到正确的模$p^{s-1}$的余数。除法的准确性由欧拉对费马小定理的推广所暗示。</p>
<p><strong>因为$\phi(p^s) = (p-1)p^{s-1}$<br>所以找一个$x_s$同时满足$x_{s}\equiv x_1 \mod (p-1)$和$x_s \equiv c \mod p^{s-1}$<br>使$a^{x_{1}+k(p-1)p^{s-1}} \equiv b \mod p^s$</strong></p>
<p>翻译结束（）<br>以下代码</p>
<p>首先梅森旋转找出key</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;random&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    l = f.readlines()<br>l = [<span class="hljs-built_in">int</span>(i.strip()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> l]<br>t = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>,<span class="hljs-number">648</span>):<br>    t.append(l[i])<br><br>rc = RandCrack()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> t:<br>    rc.submit(i)<br>    <br>key = <span class="hljs-built_in">str</span>(rc.predict_getrandbits(<span class="hljs-number">32</span>))<br>key1= <span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(key)[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(key)<br><span class="hljs-built_in">print</span>(key1)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">3168111950</span><br><span class="hljs-string">3</span><br></code></pre></td></tr></table></figure>
<p>然后一个同态映射到加法群，根据c1和c2模n下构造两个多项式环，gcd得到n<br>注意最后减去k多加的key<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs python">ks = [...]<br>c1 = ...<br>c2 = ...<br>n = ...<br>rr = ...<br>key = <span class="hljs-number">3168111950</span><br>key1 = <span class="hljs-number">3</span><br><br><span class="hljs-comment">#sage</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> logging<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_polynomial_hgcd</span>(<span class="hljs-params">ring, a0, a1</span>):<br>    <span class="hljs-keyword">assert</span> a1.degree() &lt; a0.degree()<br><br>    <span class="hljs-keyword">if</span> a1.degree() &lt;= a0.degree() / <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br><br>    m = a0.degree() // <span class="hljs-number">2</span><br>    b0 = ring(a0.<span class="hljs-built_in">list</span>()[m:])<br>    b1 = ring(a1.<span class="hljs-built_in">list</span>()[m:])<br>    R00, R01, R10, R11 = _polynomial_hgcd(ring, b0, b1)<br>    d = R00 * a0 + R01 * a1<br>    e = R10 * a0 + R11 * a1<br>    <span class="hljs-keyword">if</span> e.degree() &lt; m:<br>        <span class="hljs-keyword">return</span> R00, R01, R10, R11<br><br>    q, f = d.quo_rem(e)<br>    g0 = ring(e.<span class="hljs-built_in">list</span>()[m // <span class="hljs-number">2</span>:])<br>    g1 = ring(f.<span class="hljs-built_in">list</span>()[m // <span class="hljs-number">2</span>:])<br>    S00, S01, S10, S11 = _polynomial_hgcd(ring, g0, g1)<br>    <span class="hljs-keyword">return</span> S01 * R00 + (S00 - q * S01) * R10, S01 * R01 + (S00 - q * S01) * R11, S11 * R00 + (S10 - q * S11) * R10, S11 * R01 + (S10 - q * S11) * R11<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fast_polynomial_gcd</span>(<span class="hljs-params">a0, a1</span>):<br><br>    <span class="hljs-keyword">assert</span> a0.parent() == a1.parent()<br><br>    <span class="hljs-keyword">if</span> a0.degree() == a1.degree():<br>        <span class="hljs-keyword">if</span> a1 == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> a0<br>        a0, a1 = a1, a0 % a1<br>    <span class="hljs-keyword">elif</span> a0.degree() &lt; a1.degree():<br>        a0, a1 = a1, a0<br><br>    <span class="hljs-keyword">assert</span> a0.degree() &gt; a1.degree()<br>    ring = a0.parent()<br><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        logging.debug(<span class="hljs-string">f&quot;deg(a0) = <span class="hljs-subst">&#123;a0.degree()&#125;</span>, deg(a1) = <span class="hljs-subst">&#123;a1.degree()&#125;</span>&quot;</span>)<br>        _, r = a0.quo_rem(a1)<br>        <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> a1.monic()<br><br>        R00, R01, R10, R11 = _polynomial_hgcd(ring, a0, a1)<br>        b0 = R00 * a0 + R01 * a1<br>        b1 = R10 * a0 + R11 * a1<br>        <span class="hljs-keyword">if</span> b1 == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> b0.monic()<br><br>        _, r = b0.quo_rem(b1)<br>        <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> b1.monic()<br><br>        a0 = b1<br>        a1 = r<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">omega</span>(<span class="hljs-params">x, p, e</span>):<br>    numerator = (<span class="hljs-built_in">pow</span>(x, (p - <span class="hljs-number">1</span>) * p**(e-<span class="hljs-number">1</span>), p**(<span class="hljs-number">2</span> * e - <span class="hljs-number">1</span>)) - <span class="hljs-number">1</span>) % p**(<span class="hljs-number">2</span> * e - <span class="hljs-number">1</span>)<br>    denominator = <span class="hljs-built_in">pow</span>(p, e)<br>    ans = (<span class="hljs-built_in">int</span>(numerator) // <span class="hljs-built_in">int</span>(denominator)) % p**(e-<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> ans<br><br>coeff = []<br><span class="hljs-keyword">for</span> i, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ks):<br>    base = omega(<span class="hljs-number">69</span>, rr, i+key1)<br>    target = omega(k, rr, i+key1)<br>    kk = target * gmpy2.invert(base, rr**(i + key1 - <span class="hljs-number">1</span>)) % rr**(i + key1 - <span class="hljs-number">1</span>)-key<span class="hljs-comment">#多了个key要在这里减掉</span><br><br>    coeff.append(kk)<br><br>x = PolynomialRing(Zmod(n), <span class="hljs-string">&#x27;x&#x27;</span>).gen()<br><br>f1 = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(coeff):<br>    f1 += k*x**i<br><br>f1 = f1**<span class="hljs-number">127</span> - c1<br>f2 = x**<span class="hljs-number">65537</span> - c2<br><br>h = fast_polynomial_gcd(f1, f2)<br>m = -h[<span class="hljs-number">0</span>] / h[<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(m)))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;XYCTF&#123;ba76e13f-269e-4481-baf0-4a50ad17f891&#125;&#x27;</span><br></code></pre></td></tr></table></figure><br>参考：<a target="_blank" rel="noopener" href="https://giapppp.github.io/posts/bi0s/#2%20rr">bi0sCTF 2024 - Giap’s Blog (giapppp.github.io)</a></p>
<h3 id="LCG-and-HNP"><a href="#LCG-and-HNP" class="headerlink" title="LCG_and_HNP"></a>LCG_and_HNP</h3><p>花了一天多的时间认真啃了啃LCG</p>
<script type="math/tex; mode=display">\begin{align}
&s_{n+1}=as_{n}+b\mod{p}\\
&拆分高低位，s_{n}=h_{n}+l_{n}\\
&h_{n+1}+l_{n+1}=a(h_{n}+l_{n})+b\mod{p}\\
&l_{n+1}=al_{n}+ah_{n}+b-h_{n+1}\mod{p}\\
&l_{n+2}=al_{n+1}+ah_{n+1}+b-h_{n+2}\mod{p}\\
&\therefore l_{n+2}=al_{n}+a(ah_{n}+b-h_{n+1})+(ah_{n+1}+b-h_{n+2})\mod{p}\\
&构造A ,B\\
&l_{n+1}= A_{n}+b_{n}+k_{n}m\\
&构造lattice
\end{align}</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#sage</span><br>p=<span class="hljs-number">183640370379099520304414468793633666661</span><br>a=<span class="hljs-number">36108041497607074474855679331694767924</span><br>b=<span class="hljs-number">65925932211985158779695144876342622462</span><br>out=[<span class="hljs-number">34</span>, <span class="hljs-number">95</span>, <span class="hljs-number">100</span>, <span class="hljs-number">114</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">17</span>, <span class="hljs-number">118</span>, <span class="hljs-number">115</span>, <span class="hljs-number">29</span>, <span class="hljs-number">73</span>, <span class="hljs-number">47</span>, <span class="hljs-number">12</span>, <span class="hljs-number">133</span>, <span class="hljs-number">78</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>, <span class="hljs-number">73</span>, <span class="hljs-number">87</span>, <span class="hljs-number">15</span>, <span class="hljs-number">85</span>, <span class="hljs-number">47</span>, <span class="hljs-number">20</span>, <span class="hljs-number">136</span>, <span class="hljs-number">6</span>, <span class="hljs-number">106</span>, <span class="hljs-number">74</span>, <span class="hljs-number">27</span>, <span class="hljs-number">116</span>, <span class="hljs-number">8</span>]<br>c=<span class="hljs-number">6003642257316152022364486167163125577018867662610595926973616937741281227891381713617380</span><br><br>out.insert(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(out)):<br>    out[i] &lt;&lt;= <span class="hljs-number">120</span><br>A = [<span class="hljs-number">1</span>]<br>B = [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(out)-<span class="hljs-number">1</span>):<br>    A.append(a*A[i-<span class="hljs-number">1</span>] % p)<br>    B.append((a*B[i-<span class="hljs-number">1</span>]+a*out[i]+b-out[i+<span class="hljs-number">1</span>]) % p)<br>A = A[<span class="hljs-number">1</span>:]<br>B = B[<span class="hljs-number">1</span>:]<br><br>Ai = matrix(A)<br>Bi = matrix(B)<br>Mi = matrix.identity(<span class="hljs-built_in">len</span>(out)-<span class="hljs-number">2</span>)*p<br>K = ZZ(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-number">128</span>-<span class="hljs-number">8</span>))<br>M = matrix.block([[Mi,ZZ(<span class="hljs-number">0</span>),ZZ(<span class="hljs-number">0</span>)],[Ai,ZZ(<span class="hljs-number">1</span>),ZZ(<span class="hljs-number">0</span>)],[Bi,ZZ(<span class="hljs-number">0</span>),K]])<br><br>ll = M.LLL()[<span class="hljs-number">0</span>]<br>l1 = ll[-<span class="hljs-number">2</span>]<br>h1 = out[<span class="hljs-number">1</span>]<br>s1 = l1+h1<br><span class="hljs-comment">#for s1=a*seed+b%m</span><br>seed = ((s1-b)*inverse_mod(a,p))%p<br><span class="hljs-built_in">print</span>(seed)<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">98265113854859913689289076942864611315</span><br></code></pre></td></tr></table></figure>
<p>土法炼钢的又一天</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python">seed = <span class="hljs-number">98265113854859913689289076942864611315</span><br><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LCG</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, seed, a, b, p</span>):<br>        self.seed = seed<br>        self.a = a<br>        self.b = b<br>        self.p = p<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">self</span>):<br>        self.seed = (self.seed * self.a + self.b) % self.p<br>        <span class="hljs-keyword">return</span> self.seed &gt;&gt; (self.p.bit_length() - <span class="hljs-number">8</span>)<br>  <br>p=<span class="hljs-number">183640370379099520304414468793633666661</span><br>a=<span class="hljs-number">36108041497607074474855679331694767924</span><br>b=<span class="hljs-number">65925932211985158779695144876342622462</span><br>c=<span class="hljs-number">6003642257316152022364486167163125577018867662610595926973616937741281227891381713617380</span><br>  <br>out = []<br>lcg = LCG(seed, a, b, p)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>    out.append(lcg.<span class="hljs-built_in">next</span>())<br>key = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    key += <span class="hljs-built_in">str</span>(lcg.<span class="hljs-built_in">next</span>())<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(key) &gt;= c:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(long_to_bytes(c^<span class="hljs-built_in">int</span>(key)))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;XYCTF&#123;2h1_21_ZHi_5h0u_yU_zI_xI3_l@0&#125;&#x27;</span><br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>XYCTF-Crypto方向部分wp</div>
      <div>http://example.com/2024/04/28/XYCTF/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>AlLvia</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年4月28日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/04/26/LCG/" title="LCG">
                        <span class="hidden-mobile">LCG</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
